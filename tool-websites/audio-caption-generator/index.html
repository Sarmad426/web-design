<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Audio to Text Caption Generator</title>
    <style>
      body {
        font-family: system-ui, sans-serif;
        background: #f7f7f7;
        color: #333;
        max-width: 800px;
        margin: 40px auto;
        padding: 20px;
      }
      h1 {
        text-align: center;
      }
      .controls {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin: 20px 0;
      }
      button {
        background: #0070f3;
        border: none;
        color: white;
        padding: 10px 18px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 15px;
      }
      button:disabled {
        background: #999;
        cursor: not-allowed;
      }
      #captions {
        background: white;
        border-radius: 8px;
        padding: 15px;
        min-height: 150px;
        line-height: 1.5;
        white-space: pre-wrap;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      }
      audio {
        display: block;
        margin: 20px auto;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <h1>üéôÔ∏è Audio Caption Generator</h1>

    <p>
      Upload an audio file (MP3/WAV) and play it ‚Äî then click
      <b>Start Capturing</b> to transcribe it live using your microphone input.
    </p>

    <input type="file" id="audioInput" accept="audio/*" />
    <audio id="audioPlayer" controls></audio>

    <div class="controls">
      <button id="startBtn">Start Capturing</button>
      <button id="stopBtn" disabled>Stop</button>
    </div>

    <div id="captions" placeholder="Captions will appear here..."></div>

    <script>
      const audioInput = document.getElementById("audioInput");
      const audioPlayer = document.getElementById("audioPlayer");
      const startBtn = document.getElementById("startBtn");
      const stopBtn = document.getElementById("stopBtn");
      const captionsDiv = document.getElementById("captions");

      // Handle audio upload
      audioInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (file) {
          const url = URL.createObjectURL(file);
          audioPlayer.src = url;
        }
      });

      // Initialize speech recognition
      const SpeechRecognition =
        window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        alert(
          "SpeechRecognition API not supported in this browser. Use Chrome."
        );
      }

      const recognition = new SpeechRecognition();
      recognition.lang = "en-US";
      recognition.continuous = true;
      recognition.interimResults = true;

      let finalTranscript = "";

      recognition.onresult = (event) => {
        let interim = "";
        for (let i = event.resultIndex; i < event.results.length; ++i) {
          const transcript = event.results[i][0].transcript;
          if (event.results[i].isFinal) {
            finalTranscript += transcript + " ";
          } else {
            interim += transcript;
          }
        }
        captionsDiv.innerText = finalTranscript + " " + interim;
      };

      recognition.onerror = (event) => {
        console.error("Recognition error:", event.error);
      };

      startBtn.onclick = () => {
        recognition.start();
        startBtn.disabled = true;
        stopBtn.disabled = false;
      };

      stopBtn.onclick = () => {
        recognition.stop();
        startBtn.disabled = false;
        stopBtn.disabled = true;
      };
    </script>
  </body>
</html>
